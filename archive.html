<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZYYDYEC6T"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-SZYYDYEC6T');
  </script>
  
  <meta name="description" content="Архив игровых статей One1Game — обзоры, гайды, новости игровой индустрии. Все материалы в одном месте." />
  <meta name="keywords" content="игровые статьи, обзоры игр, гайды, игровые новости, one1game, gaming articles" />
  <title>Архив статей - One1Game</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;400;500;600&display=swap" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="styles.css" />
  <style>
    .articles-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 40px 20px;
    }
    
    .article-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
      min-height: 600px;
    }
    
    .article-item {
      background: rgba(16, 16, 26, 0.8);
      padding: 25px;
      border-radius: 12px;
      border: 1px solid rgba(255, 193, 7, 0.3);
      transition: transform 0.3s ease, border-color 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .article-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
      transition: left 0.6s ease;
    }
    
    .article-item:hover::before {
      left: 100%;
    }
    
    .article-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }
    
    .article-link:hover .article-item {
      border-color: #00ff88;
      transform: translateX(10px);
    }
    
    .article-item h3 {
      color: #00f3ff;
      margin-bottom: 10px;
      font-size: 1.3rem;
    }
    
    .article-item p {
      color: #cccccc;
      line-height: 1.6;
    }
    
    .article-meta {
      display: flex;
      align-items: center;
      gap: 15px;
      color: #b0b0b0;
      font-size: 0.9rem;
      margin-top: 15px;
      flex-wrap: wrap;
    }
    
    .article-meta i {
      color: #00ff88;
    }
    
    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 30px;
      color: #00f3ff;
      text-decoration: none;
      padding: 8px 16px;
      border: 1px solid rgba(0, 243, 255, 0.3);
      border-radius: 6px;
      transition: all 0.3s ease;
    }
    
    .back-btn:hover {
      background: rgba(0, 243, 255, 0.1);
      transform: translateX(-5px);
    }

    /* Пагинация */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 40px;
      flex-wrap: wrap;
    }

    .page-btn {
      padding: 10px 16px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #00f3ff;
      border-radius: 6px;
      color: #ffffff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 500;
      min-width: 44px;
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .page-btn:hover:not(.disabled) {
      background: rgba(0, 243, 255, 0.2);
      transform: translateY(-2px);
    }

    .page-btn.active {
      background: #00f3ff;
      color: #000;
      font-weight: 600;
      box-shadow: 0 0 15px #00f3ff;
    }

    .page-btn.disabled {
      opacity: 0.5;
      cursor: not-allowed;
      pointer-events: none;
    }

    .dots {
      padding: 10px;
      color: #666;
    }

    /* Loading state */
    .loading {
      text-align: center;
      padding: 40px;
      color: #00f3ff;
      font-size: 1.2rem;
    }

    /* Категории */
    .category-filter {
      display: flex;
      gap: 10px;
      margin-bottom: 25px;
      flex-wrap: wrap;
      justify-content: center;
    }
    
    .category-btn {
      padding: 8px 18px;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid #8a2be2;
      border-radius: 20px;
      color: #b0b0b0;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.95rem;
      font-family: 'Rajdhani', sans-serif;
      font-weight: 500;
    }
    
    .category-btn.active {
      background: #8a2be2;
      color: #ffffff;
      font-weight: 600;
      box-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
    }
    
    .category-btn:hover:not(.active) {
      background: rgba(138, 43, 226, 0.3);
      transform: translateY(-2px);
    }
    
    .no-articles {
      text-align: center;
      padding: 60px 20px;
      color: #888;
      font-size: 1.1rem;
      background: rgba(16, 16, 26, 0.8);
      border-radius: 12px;
      border: 1px solid rgba(255, 193, 7, 0.1);
    }
  </style>
</head>
<body>
  <div class="cyber-bg"></div>
  
  <div class="container">
    <div class="articles-container">
      <a href="index.html" class="back-btn">
        <i class="fas fa-arrow-left"></i> На главную
      </a>
      
      <h1 style="text-align: center; margin-bottom: 40px;">
        <i class="fas fa-newspaper"></i> Игровые Статьи
      </h1>
      
      <!-- Фильтр по категориям -->
      <div class="category-filter" id="category-filter">
        <button class="category-btn active" data-category="all">Все статьи</button>
        <!-- Категории будут добавлены динамически -->
      </div>
      
      <!-- Список статей -->
      <div class="article-list" id="articles-list">
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i> Загрузка статей...
        </div>
      </div>

      <!-- Пагинация -->
      <div class="pagination" id="pagination">
        <!-- Кнопки страниц будут генерироваться через JavaScript -->
      </div>
    </div>
  </div>

  <!-- Подключаем файл со статьями -->
  <script src="articles-data.js"></script>
  
  <script>
    // Конфигурация
    const ARTICLES_PER_PAGE = 5;
    let currentPage = 1;
    let currentCategory = 'all';
    let filteredArticles = [];

    // DOM элементы
    const articlesList = document.getElementById('articles-list');
    const pagination = document.getElementById('pagination');
    const categoryFilter = document.getElementById('category-filter');

    // Функция для получения всех уникальных категорий
    function getAllCategories(articles) {
      const categories = new Set();
      articles.forEach(article => {
        if (article.category && article.category.trim() !== '') {
          categories.add(article.category);
        }
      });
      return Array.from(categories).sort();
    }

    // Инициализация фильтра по категориям
    function initCategoryFilter(articles) {
      const categories = getAllCategories(articles);
      
      // Очищаем кнопки (оставляем только "Все статьи")
      while (categoryFilter.children.length > 1) {
        categoryFilter.removeChild(categoryFilter.lastChild);
      }
      
      categories.forEach(category => {
        const btn = document.createElement('button');
        btn.className = 'category-btn';
        btn.textContent = category;
        btn.dataset.category = category;
        btn.onclick = () => changeCategory(category);
        categoryFilter.appendChild(btn);
      });
    }

    // Смена категории - ИСПРАВЛЕННАЯ ВЕРСИЯ
    function changeCategory(category) {
      // Обновляем текущую категорию
      currentCategory = category;
      currentPage = 1;
      
      // Убираем active у всех кнопок
      document.querySelectorAll('.category-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      
      // Добавляем active к выбранной кнопке
      const activeBtn = category === 'all' 
        ? document.querySelector('.category-btn[data-category="all"]')
        : document.querySelector(`.category-btn[data-category="${category}"]`);
      
      if (activeBtn) {
        activeBtn.classList.add('active');
      }
      
      // Фильтруем статьи
      if (category === 'all') {
        filteredArticles = [...window.allArticles];
      } else {
        filteredArticles = window.allArticles.filter(article => 
          article.category && article.category === category
        );
      }
      
      // Отображаем статьи
      displayArticles(currentPage);
    }

    // Отображение статей
    function displayArticles(page = 1) {
      if (!window.allArticles || window.allArticles.length === 0) {
        articlesList.innerHTML = '<div class="no-articles"><i class="fas fa-exclamation-triangle"></i> Статьи не найдены или не загружены</div>';
        pagination.innerHTML = '';
        return;
      }

      // Инициализируем фильтр при первом отображении
      if (filteredArticles.length === 0) {
        filteredArticles = [...window.allArticles];
        if (categoryFilter.children.length === 1) {
          initCategoryFilter(window.allArticles);
        }
      }

      const startIndex = (page - 1) * ARTICLES_PER_PAGE;
      const endIndex = startIndex + ARTICLES_PER_PAGE;
      const articlesToShow = filteredArticles.slice(startIndex, endIndex);

      if (articlesToShow.length === 0) {
        articlesList.innerHTML = `
          <div class="no-articles">
            <i class="fas fa-search"></i><br><br>
            В категории "${currentCategory === 'all' ? 'Все статьи' : currentCategory}" статьи не найдены
          </div>
        `;
        pagination.innerHTML = '';
        return;
      }

      articlesList.innerHTML = articlesToShow.map(article => `
        <a href="${article.url || '#'}" class="article-link" aria-label="Читать статью: ${article.title}">
          <div class="article-item">
            <h3>${article.title || 'Без названия'}</h3>
            <p>${article.excerpt || 'Описание отсутствует'}</p>
            <div class="article-meta">
              <span><i class="far fa-calendar"></i> ${article.date || 'Не указано'}</span>
              <span><i class="far fa-clock"></i> ${article.readTime || '5 мин'}</span>
              ${article.category ? `<span style="color: #8a2be2;"><i class="fas fa-tag"></i> ${article.category}</span>` : ''}
            </div>
          </div>
        </a>
      `).join('');

      currentPage = page;
      updatePagination();
    }

    // Обновление пагинации
    function updatePagination() {
      const totalPages = Math.ceil(filteredArticles.length / ARTICLES_PER_PAGE);
      
      if (totalPages <= 1) {
        pagination.innerHTML = '';
        return;
      }

      let paginationHTML = '';

      // Кнопка "Назад"
      paginationHTML += `
        <button class="page-btn ${currentPage === 1 ? 'disabled' : ''}" 
                onclick="changePage(${currentPage - 1})" 
                ${currentPage === 1 ? 'disabled' : ''}
                aria-label="Предыдущая страница">
          <i class="fas fa-chevron-left"></i>
        </button>
      `;

      // Номера страниц
      const maxVisiblePages = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
      let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

      if (endPage - startPage + 1 < maxVisiblePages) {
        startPage = Math.max(1, endPage - maxVisiblePages + 1);
      }

      if (startPage > 1) {
        paginationHTML += `<button class="page-btn" onclick="changePage(1)">1</button>`;
        if (startPage > 2) paginationHTML += `<span class="dots">...</span>`;
      }

      for (let i = startPage; i <= endPage; i++) {
        paginationHTML += `
          <button class="page-btn ${i === currentPage ? 'active' : ''}" 
                  onclick="changePage(${i})"
                  aria-label="Страница ${i}">
            ${i}
          </button>
        `;
      }

      if (endPage < totalPages) {
        if (endPage < totalPages - 1) paginationHTML += `<span class="dots">...</span>`;
        paginationHTML += `<button class="page-btn" onclick="changePage(${totalPages})">${totalPages}</button>`;
      }

      // Кнопка "Вперед"
      paginationHTML += `
        <button class="page-btn ${currentPage === totalPages ? 'disabled' : ''}" 
                onclick="changePage(${currentPage + 1})" 
                ${currentPage === totalPages ? 'disabled' : ''}
                aria-label="Следующая страница">
          <i class="fas fa-chevron-right"></i>
        </button>
      `;

      pagination.innerHTML = paginationHTML;
    }

    // Смена страницы
    function changePage(page) {
      if (page < 1 || page > Math.ceil(filteredArticles.length / ARTICLES_PER_PAGE)) return;
      displayArticles(page);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // Инициализация при загрузке
    document.addEventListener('DOMContentLoaded', () => {
      console.log('DOM загружен, проверяем статьи...');
      
      // Проверяем загрузку статей
      if (window.allArticles && window.allArticles.length > 0) {
        console.log(`Загружено ${window.allArticles.length} статей`);
        displayArticles(1);
      } else {
        console.log('Статьи еще не загружены, ожидаем...');
        
        // Если articles-data.js еще не загружен, пытаемся загрузить вручную
        if (!window.allArticles) {
          window.allArticles = [];
          
          // Создаем тестовые данные, если файл не загрузился
          setTimeout(() => {
            if (window.allArticles.length === 0) {
              console.warn('Файл articles-data.js не загрузился, создаем тестовые данные');
              window.allArticles = [
                {
                  title: "Тестовая статья 1",
                  excerpt: "Это тестовая статья для демонстрации работы фильтра",
                  date: "2024-01-15",
                  readTime: "5 мин",
                  category: "Гайды",
                  url: "#"
                },
                {
                  title: "Тестовая статья 2",
                  excerpt: "Еще одна тестовая статья",
                  date: "2024-01-14",
                  readTime: "3 мин",
                  category: "Новости",
                  url: "#"
                },
                {
                  title: "Тестовая статья 3",
                  excerpt: "Статья без категории",
                  date: "2024-01-13",
                  readTime: "7 мин",
                  category: "",
                  url: "#"
                }
              ];
            }
            displayArticles(1);
          }, 1000);
        }
        
        // Или проверяем каждые 500мс
        const checkArticles = setInterval(() => {
          if (window.allArticles && window.allArticles.length > 0) {
            clearInterval(checkArticles);
            console.log(`Статьи загружены через интервал: ${window.allArticles.length} шт`);
            displayArticles(1);
          }
        }, 500);
      }
    });

    // Экспортируем функции для использования в консоли
    window.changePage = changePage;
    window.changeCategory = changeCategory;
    window.getCurrentState = () => ({
      currentPage,
      currentCategory,
      totalArticles: window.allArticles?.length || 0,
      filteredArticles: filteredArticles.length
    });
  </script>
</body>
</html>